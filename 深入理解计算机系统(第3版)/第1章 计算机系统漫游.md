# 信息就是位+上下文

* 只由 ASCII 字符构成的文件为文本文件，其他文件为二进制文件
* 系统中所有信息都是由一串比特表示
* 区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文

# 程序被其他程序翻译成不同格式

* 编译系统：预处理器、编译器、汇编器、链接器一起构成

## 预处理阶段

* 预处理器（cpp）根据 #开头的命令，读取系统头文件并直接插入程序文本，以 .i 作为文件扩展名得到另一个 C 程序

## 编译阶段

* 编译器（ccl）将文本文件 .i 翻译为文本文件 .s，包含汇编语言程序
* 汇编语言为不同高级语言的不同编译器提供通用输出语言

## 汇编阶段

* 汇编器（as）将.s 文件翻译为机器语言指令，将指令打包为可重定位目标程序，结果保存到 .o  文件中
* .o 文件为二进制文件，包含指令编码

## 链接阶段

* 链接器（ld）负责处理预编译目标文件和当前文件的合并
* 合并后得到可执行目标文件，简称可执行文件，可以被加载到内存中，由系统执行

# 了解编译系统如何工作大有益处

* 优化程序性能
* 理解链接时出现的错误
* 避免安全漏洞

# 处理器读并解释存储在内存中的指令
## 系统的硬件组成
### 总线

* 贯穿整个系统的一组电子管道，负责携带信息字节负责在各个部件间传递
* 总线被设计成传送定长字节块，word
* word 是基本系统参数，各系统不尽相同

### I/O 设备

* 系统与外部世界的联系通道
* 每个 I/O 设备通过一个控制器或适配器与 I/O 总线相连
* 控制器与适配器区别在于封装方式
	* 控制器是 I/O 设备本身或者系统的主印制电路板（主板）上的芯片组
	* 适配器则是一块插在主板插槽上的卡

### 内存

* 主存用来存放程序和程序处理的数据
* 物理上由一组动态随机存取存储器（DRAM）芯片组成
* 逻辑上是一个线性字节数组，每个字节有其唯一地址（数组索引从0开始）

### 处理器

* 解释（或执行）存储在主存中指令的引擎
* 核心是一个大小为一个字的存储设备（寄存器）程序计数器（PC）
* 任何时刻，PC 都指向主存中的某条机器指令（即含有该条指令的地址）
* 处理器按照指令执行模型操作，模型由指令集架构决定
	* 加载：从主存复制一个字节或者一个字到寄存器，覆盖寄存器原来的内容
	* 存储：从寄存器复制一个字节或者一个字到主存上某位置，覆盖原来在该位置上的内容
	* 操作：把两个寄存器的内容复制到ALU（算术/逻辑单元），ALU 对这两个字做算术运算，将结果存到一个寄存器中，覆盖该寄存器原来的内容
	* 跳转：从指令本身抽取一个字，将这个字复制到程序计数器（PC）中，覆盖PC中原来的值
* 指令集架构描述每条机器代码指令的效果
* 微体系结构描述处理器实际上如何实现

# 高速缓存（cache memory）

* 存放处理器近期可能会需要的信息
* 使用静态随机访问存储器 SRAM 实现
* 利用高速缓存局部性原理，程序具有访问局部区域里的数据和代码的趋势

# 存储设备形成层次结构

* 主要思想是上一层的存储器作为第一层存储器的高速缓存

# 操作系统管理硬件

操作系统两个基本功能：  

1. 防止硬件被失控的应用程序滥用
2. 向应用程序提供简单一直的机制来控制复杂而又通常大不相同的低级硬件设备

* 操作系统通过进程、虚拟内存和文件等抽象概念来实现这两个功能
* 文件是对 I/O 设备的抽象表示
* 虚拟内存是对主存和磁盘 I/O 的抽象表示
* 进程是对处理器、主存和 I/O 设备的抽象表示

## 进程

* 是对一个程序的抽象
* 并发运行：是一个进程的指令和另一个进程的指令交错执行
* 上下文切换：操作系统实现交错执行的机制
* 操作系统把控制权从当前进程转移到某个新进程会进行上下文切换，保存当前进程上下文、恢复新进程上下文，将控制权传递到新进程
* 进程的转换由操作系统内核 kernel 管理
* 内核不是一个独立的进程，它是系统管理全部进程所用代码和数据结构的集合

## 线程

* 一个进程可以由多个线程执行单元组成
* 每个线程都运行在进程的上下文中，共享同样的代码和全局数据

## 虚拟内存

* 为每个进程提供假象，即每个进程都在独占使用主存
* 每个进程看到的内存一致，称为虚拟地址空间

## 虚拟地址空间

基本思想：把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存

* 程序代码和数据：直接按照可执行目标文件的内容初始化
* 堆：运行时动态扩展和收缩
* 共享库：标准库、数学库等
* 栈：每次调用函数，栈会增长；从一个函数返回，栈会收缩
* 内核虚拟内存：不允许应用程序读写该区域内容或直接调用内核代码定义的函数，必须调用内核执行相关操作

## 文件

* 文件就是字节序列
* 每个 I/O 设备，甚至网络都可以看成文件
* 系统中所有输入输出都是通过使用 Unix I/O 系统函数调用读写文件来实现

# 系统之间利用网络通信

# 重要主题

## Amdahl 定律

* 当我们对系统的某个部分加速时，其对系统整体性能的影响取决于该部分的重要性和加速程度
* 要想显著加速整个系统，必须提升全系统中相当大的部分的速度

## 并发和并行

* 两个需求驱动进步持续动力：想要计算机做的更多；想要计算机运行的更快
* 并发 concurrency 指一个同事具有多个活动的系统
* 并行 parallelism 指用并发来使一个系统运行更快

## 计算机系统中抽象的重要性

* 处理器中，指令集架构提供了对实际处理器硬件的抽象
* 文件是对 I/O 设备的抽象
* 虚拟内存是对程序存储器的抽象
* 进程是对程序的抽象
* 虚拟机是对整个计算机的抽象，包括操作系统、处理器和程序

# 小结

* 计算机系统由于硬件和软件组成，两者相互协作运行应用程序
* 系统中的存储设备划分为层次结构，高层比底层要快，且可以作为底层的缓存设备
* 操作系统内核是对软件和硬件的抽象：文件是对 I/O 设备的抽象，虚拟内存是对主存和磁盘的抽象，进程是对处理器、主存和 I/O 设备的抽象
* 网络提供了计算机之间的通信，网络也是一种 I/O 设备



